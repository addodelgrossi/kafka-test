version: '3'
services:
  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    networks: 
      - broker-kafka
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
      ZOOKEEPER_SASL_ENABLED: "false"
    ports:
      - 2181:2181
  kafka:
    image: confluentinc/cp-kafka:latest
    networks: 
      - broker-kafka
    depends_on:
      - zookeeper
    ports:
      - 9092:9092
      - 9093:9093
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_LISTENERS: SSL://kafka:9093,PLAINTEXT://localhost:9092
      KAFKA_ADVERTISED_LISTENERS: SSL://kafka:9093,PLAINTEXT://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: SSL:SSL,PLAINTEXT:PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_SECURITY_INTER_BROKER_PROTOCOL: SSL
      KAFKA_SSL_KEYSTORE_FILENAME: docker.kafka.server.keystore.jks
      KAFKA_SSL_KEYSTORE_CREDENTIALS: server_keystore_creds
      KAFKA_SSL_KEY_CREDENTIALS: server_sslkey_creds
      KAFKA_SSL_TRUSTSTORE_FILENAME: docker.kafka.server.truststore.jks
      KAFKA_SSL_TRUSTSTORE_CREDENTIALS: server_truststore_creds
      KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: " "
      KAFKA_SSL_CLIENT_AUTH: required 
      KAFKA_SECURITY_PROTOCOL: SSL
    volumes: 
     - ${KAFKA_SSL_SECRETS_DIR}:/etc/kafka/secrets
  kafdrop:
    image: obsidiandynamics/kafdrop:latest
    networks: 
      - broker-kafka
    depends_on:
      - kafka
    ports:
      - 19000:9000
    environment:
      KAFKA_BROKERCONNECT: kafka:9093
      KAFKA_TRUSTSTORE: MIIETgIBAzCCBAcGCSqGSIb3DQEHAaCCA/gEggP0MIID8DCCA+wGCSqGSIb3DQEHBqCCA90wggPZAgEAMIID0gYJKoZIhvcNAQcBMCkGCiqGSIb3DQEMAQYwGwQUl7KfAk0q83Tz8tCnEJrrV5uraocCAwDDUICCA5hKOT3gB6w/jGa2rCMuC7noSO/g5FMKYBtNLHA0XvjNZOJ7Bk2Mc//yMR/slsitI8tMVBJtPL6tkkN+yi2Vff4gj5Ps7PvTEw6tkKLiU59CM1VOc//oEPs/XmdD/epDWaCnD7m5El9/Ec0HHS6KtgD+keSabee/5uVhkyjJEGFpZHhUYk5OcluwrJp2EyYKFsM5vL0t/z89DB541zATIYn3YmLA/XI2KmI9rta+74w0PDZQ6gk6UnAS+d1GmHuKnLGcCdrA0DqsDppn1bVPebhxXw7/9UQ9+lZXJ9TzKrJiMY6o7t269wXUW2r2+++VigY4RqdM624h3m650LpQkBll76YiKYq9pvbefnIqacJRyN92DgFchMpNFeQksbv/9iO65bKQW+h/ELkJpouR2Qx1XMFfWrYnAHMKrbqEIUicmvJGQbb16gDG3IgfYtqCMIZ78YrwghdzcaHzOxO4mjan24skBcXq1mHXigFosAZ059QPiADSlgyBdN39gNaIET//t7ZmST55lajmkkYTEqxgAhuU4ncxJG4F0rWhPUzdqaFJFBVNncdxpksiH8QQVwbxMCrean7aaEcl9k8y44hoFWz/7zXTgfPJJaRA0SI9Gf2laQest1J5pHijSqjMp6K/PK+M1Kh1nEilh7SwOVDY6Fy/A5jr5Cnuk7k0r1vqdZ/J5kaSU89519vK8eYNXd8IHLty1W8caokySSMk472+HxuOOUs7053NJLxv1zxT2yFRVyDwfOsciWw7hnHUVCiGGCUJUmNWOAPV3bQo3uGu/R/oKeV+/yOs8ZdKb/I+ahEj7Ak7FcjKaBsVQhewArl89PnBoko0JzJphoSrBfxCMtgUsukiO7zlYg3tkAnlejH5/mOenl0hLJ5r8To3HWCMWIFZiopeyNfYqOsfGyZgZYnk1C0slrHsIpOzOw7EBM03dMZw2Ma3dxqtZ8cuBY5ucj2soEBFSvyXuEA1M9B9rl7x+l7o8EISXZcx4+ZhNcKu88zs3RtS7q203C15NPIT9AnHuiQTB8ky/wtU+/ea721Yd3NyYgxnh91FI6StGLLW8Y9N7xhow9GGhuF6QVBb/n4dgIIp9fBIeW6fP8NlyCmH5gmkYECYM58LoV/Kdh/aOz82vgm834aKqk+nj1CKnl7I3XY6iifWweoYORbjtKQHKCYvS/0lAv/HtGGCenVRQll/byQ5vAydUfUnOKeSV36JIS67djA+MCEwCQYFKw4DAhoFAAQUDXlfkOSoqP872saZMq1EGxWB4UcEFMzsdOUoHczGCcl0m+pRp5oyoN0gAgMBhqA=
      KAFKA_KEYSTORE: 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
      KAFKA_PROPERTIES: c2VjdXJpdHkucHJvdG9jb2w9U1NMCnNzbC5lbmRwb2ludC5pZGVudGlmaWNhdGlvbi5hbGdvcml0aG09CnNzbC50cnVzdHN0b3JlLnBhc3N3b3JkPWthZmthZG9ja2VyCnNzbC5rZXlzdG9yZS5wYXNzd29yZD1rYWZrYWRvY2tlcg==
networks: 
  broker-kafka:
    driver: bridge