version: '3'
services:
  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    networks: 
      - broker-kafka
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
      ZOOKEEPER_SASL_ENABLED: "false"
    ports:
      - 2181:2181
  kafka:
    image: confluentinc/cp-kafka:latest
    networks: 
      - broker-kafka
    depends_on:
      - zookeeper
    ports:
      - 9092:9092
      - 9093:9093
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_LISTENERS: SSL://kafka:9093,PLAINTEXT://localhost:9092
      KAFKA_ADVERTISED_LISTENERS: SSL://kafka:9093,PLAINTEXT://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: SSL:SSL,PLAINTEXT:PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_SECURITY_INTER_BROKER_PROTOCOL: SSL
      KAFKA_SSL_KEYSTORE_FILENAME: docker.kafka.server.keystore.jks
      KAFKA_SSL_KEYSTORE_CREDENTIALS: server_keystore_creds
      KAFKA_SSL_KEY_CREDENTIALS: server_sslkey_creds
      KAFKA_SSL_TRUSTSTORE_FILENAME: docker.kafka.server.truststore.jks
      KAFKA_SSL_TRUSTSTORE_CREDENTIALS: server_truststore_creds
      KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: " "
      KAFKA_SSL_CLIENT_AUTH: required 
      KAFKA_SECURITY_PROTOCOL: SSL
    volumes: 
     - ${KAFKA_SSL_SECRETS_DIR}:/etc/kafka/secrets
  kafdrop:
    image: obsidiandynamics/kafdrop:latest
    networks: 
      - broker-kafka
    depends_on:
      - kafka
    ports:
      - 19000:9000
    environment:
      KAFKA_BROKERCONNECT: kafka:9093
      KAFKA_TRUSTSTORE: MIIETgIBAzCCBAcGCSqGSIb3DQEHAaCCA/gEggP0MIID8DCCA+wGCSqGSIb3DQEHBqCCA90wggPZAgEAMIID0gYJKoZIhvcNAQcBMCkGCiqGSIb3DQEMAQYwGwQULMkxK6AUHifIASPSwy4Ym+CAlHgCAwDDUICCA5hfxvCsjZR440zG8FXq/9ZSVrHk11NdqunGcCzDcf0v3Fm/ESteQvqJDGOYF8RAnigYEwxFPSZpqG9J/j6HzMC7rwL9FqNT8jnAxPbA2WdBPNmOlbUIxYUiOYV/x+84VALtyppGAhEbrgdcXoo/LLKD86E81WUlQ65baGJPc7R74ANR581ihwJDqMl01v2/Sl2IamPq3QjkoWRKaYrHwtRSsA8L8k1R62px4fct9+4274mHDxHiVYYYitNIX3RpVxicu8v0b4b7kdhI83js5Kq3NidCzvLk5dlYBuGEjOgA3JxzGNXUgfl5bYUEcAEfUvQ27PIIazvFvoIo0WsIvwG88vTjoIKS64vz0gvnokR3df5TKWC6FL1K/GuCcbzL2sp5Q0HkmEhtdh7sSRzjaSnif+IaCU0q+9g/6QycgR5KwATWa/7khP1hmbRaXlI0EhDZVw9C5gDKzsAEYktbhEKJBmBhGlb14JQwGrZyTOdS2wcC5jttx3KD+fgQlyxSTr11uqboPhhm563PP00rxZU0b3wnVAiUQ1NjGDlah8MCx/MaaDM9xUxIHCY95HyRBqHwW30PhUKkAgXjnH6mRKLGES+DQa0YCfCYEQrLtMy/7YzibfcIcU2lU6rgu3GKzNmCZbFRBgGso7x08ISf9rGdnvERmV1fUgZqFCNLdf0GFlD4QCh8asSg2mxXEmjVLKR70ubCIXXaNEzD3c6U7c1w20XD9vO3pMlp0YZtKSugrRJvj7d+lo9qkXkXRYQUIdnCXT0rUU4mb9BHVaTnkbjMhRSqKRd6ScQ7R1u2kSV0w/7cKuA2s4xe4tpx/ZV0jgHtlbLMS4njvEjdHZpuKaSJv2oYLZOvPdi4ZYv/wVPk7dkY95OYodfRYeLuUrHkj7Fbu2IABwGuQR9OE85niHpbKKvysJyG7CR6Iadxt4qT/IJQhRG5QBMtxNYs6dhsdjZSRo7Rsvc2mKzmLvq4Ug13fRx1y3rCVBdDQ34o32893TWFwkQDJiXF8gOn6YxHgnj8cfdfdii6YdsZlAqc/g+gXkDVDFSuBzrhxg+xu/GNvcuHcXiQjMHHhoo6TcG1vVQEzzULwpbsIJRy5fd3aiX3zmcvfiEFSFTSQ2/R815NMNvofbSH+f9FYhkoxFUXrI46+2cBf7jr8QznqQrr1vm3thNlhs0Q7T1vHgRGAQ8/i+MvzVcqgRIA+c9j2GWOUuWWssk40zE0QDA+MCEwCQYFKw4DAhoFAAQUSPHiddviFBjjMSwE8kSNmqj5SXYEFAW/VwexI174LPj9YnMAPo1RAbc6AgMBhqA=
      KAFKA_KEYSTORE: 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
      KAFKA_PROPERTIES: c2VjdXJpdHkucHJvdG9jb2w9U1NMCnNzbC5lbmRwb2ludC5pZGVudGlmaWNhdGlvbi5hbGdvcml0aG09CnNzbC50cnVzdHN0b3JlLnBhc3N3b3JkPWthZmthZG9ja2VyCnNzbC5rZXlzdG9yZS5wYXNzd29yZD1rYWZrYWRvY2tlcg==
networks: 
  broker-kafka:
    driver: bridge